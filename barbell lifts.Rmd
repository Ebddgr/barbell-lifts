---
title: "Barbell Lift"
author: "E.Dadgar"
date: '2022-06-15'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Reading the Data

```{r,cache=TRUE}
traindata <- read.csv("/Documents and Settings/Hani/Documents/pml-training.csv",na.strings = "NA")
testdata <- read.csv("/Documents and Settings/Hani/Documents/pml-testing.csv",na.strings = "NA")
```

## Pre Processing

First 7 variables do not include informational data for the training model.
Missing values have been replaced with zeros.
Variables with more than 95% correlation are removed.

### Cleaning Process
```{r,echo=FALSE,warning=FALSE}
library(caret)
clean.data <- function(x){
        resp <- x %>% select(160)
        x <-x %>%  select(-c(1:7,160))
        # change classes to numeric
        x <- x %>% sapply(as.numeric)
        #impute missing data with zero
        x[is.na(x)]=0
        #remove near zero variables
        x <- x[,-nearZeroVar(x)]
        #remove highly correlated data
        highcorrelation <- findCorrelation(cor(x),cutoff = .95)
        x <- x[,-highcorrelation]
        #attaching the classe variable
        x <- cbind(x,resp)
        return(x)
}
train <- clean.data(traindata)
```

To reduce the complexity of the data, PCA method has been used and the components than explains more than 95% of the variance have been selected.

## Feature Selection
```{r,cache=TRUE}
pca <- prcomp(train[,-ncol(train)],center = TRUE,scale=TRUE)
components <- which(summary(pca)$importance[3,]>.95)[1]
train.pca <- cbind(as.data.frame(pca$x[,1:components]),classe=as.factor(train$classe))
test.pca <- predict(pca,testdata)[,1:components] %>% as.data.frame()
```

## Training and testing the model
Using randomForest package the model has been trained. Predicted results are as follows:
```{r,cache=TRUE}
library(randomForest)
model.fit <- randomForest(classe~.,data=train.pca)
predict(model.fit,test.pca)
```